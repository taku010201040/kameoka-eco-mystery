# 予約管理ダッシュボード セットアップ手順

このガイドでは、作成した予約管理ダッシュボードをGoogle Apps Scriptと統合して動作させるための手順を説明します。

## 📋 前提条件

- Googleアカウント
- 既存の予約管理スプレッドシート（`予約管理`シート）
- スプレッドシートへのアクセス権限

---

## 🚀 セットアップ手順

### 1. Google Apps Scriptプロジェクトの作成

1. Googleスプレッドシートを開く
   - 予約データが保存されているスプレッドシートを開きます

2. Apps Scriptエディタを開く
   - メニューから **拡張機能 > Apps Script** を選択

3. 新しいスクリプトファイルを作成
   - 左側のファイルリストで **+** ボタンをクリック
   - **スクリプト** を選択
   - ファイル名を `dashboard` に変更

4. `dashboard.gs` の内容をコピー&ペースト
   - プロジェクトフォルダの `dashboard.gs` の内容をすべてコピー
   - Apps Scriptエディタにペースト
   - **保存** (Ctrl+S または Cmd+S)

### 2. ウェブアプリとしてデプロイ

1. デプロイ
   - 右上の **デプロイ** ボタンをクリック
   - **新しいデプロイ** を選択

2. 設定
   - **種類の選択** で **ウェブアプリ** を選択
   - 以下の設定を入力：
     - **説明**: `予約管理ダッシュボードAPI`
     - **次のユーザーとして実行**: `自分`
     - **アクセスできるユーザー**: `全員` または `Googleアカウントを持つ全員`

3. デプロイ実行
   - **デプロイ** ボタンをクリック
   - 権限の承認が求められる場合は、指示に従って承認
   - **ウェブアプリのURL** が表示されるのでコピー
   - 例: `https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec`

### 3. ReactアプリにURLを設定

1. `ReservationDashboard.jsx` を開く
   - ファイルパス: `src/components/ReservationDashboard.jsx`

2. URLを更新
   ```javascript
   // 11行目あたり
   const GAS_API_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL';
   ```
   
   これを、先ほどコピーしたURLに置き換えます：
   ```javascript
   const GAS_API_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
   ```

3. ファイルを保存

### 4. アプリの起動

```bash
npm run dev
```

### 5. ダッシュボードにアクセス

ブラウザで以下のURLを開きます：
```
http://localhost:5173/?view=dashboard
```

---

## 🔄 自動更新の設定（オプション）

毎日午前0時に自動でキャッシュをクリアする設定（推奨）：

1. Apps Scriptエディタで、`setupDailyTrigger` 関数を実行
   - エディタ上部の関数選択から `setupDailyTrigger` を選択
   - **実行** ボタンをクリック
   - 権限の承認が求められる場合は承認

2. トリガーの確認
   - 左メニューの **トリガー** (時計アイコン) をクリック
   - `clearCache` 関数が毎日実行されるトリガーが設定されていることを確認

---

## 🎨 ダッシュボードの機能

### 📊 表示される情報

- **総予約数**: 全体の予約組数
- **総参加者数**: すべての参加者の合計
- **謎解き予約数**: 謎解き本編の予約組数
- **WS予約数**: 村上なつかWSの予約組数

### ⏰ 時間帯別表示

各時間帯ごとに：
- 謎解き本編の予約状況（定員6組）
- 村上なつかWSの予約状況（定員3組）
- プログレスバーで視覚的に確認
- 残り枠数の表示

### 🔄 自動更新

- 5分ごとに自動でデータを取得
- 手動更新ボタンで即座に最新データを取得

---

## ⚠️ トラブルシューティング

### エラー: 「予約データの取得に失敗しました」

**原因**: 
- ウェブアプリURLが正しく設定されていない
- Google Apps Scriptのデプロイが完了していない

**解決策**:
1. `ReservationDashboard.jsx` のURLが正しいか確認
2. Apps Scriptが正しくデプロイされているか確認
3. ブラウザのコンソールでエラーメッセージを確認

### エラー: CORS関連のエラー

**原因**: 
- ウェブアプリのアクセス権限設定が正しくない

**解決策**:
1. Apps Scriptエディタで「デプロイを管理」を開く
2. アクセス権限を「全員」に変更
3. 新しいバージョンとしてデプロイ

### データが表示されない

**原因**: 
- スプレッドシートのシート名が異なる
- データの形式が想定と異なる

**解決策**:
1. スプレッドシートのシート名が「予約管理」であることを確認
2. `dashboard.gs` の `SHEET_NAME` 変数を確認
3. Apps Scriptの実行ログを確認（**表示 > ログ**）

---

## 📱 アクセス方法まとめ

### 開発環境
```
http://localhost:5173/?view=dashboard
```

### 本番環境（Netlifyなど）
```
https://your-domain.netlify.app/?view=dashboard
```

---

## 🔐 セキュリティに関する注意

- ダッシュボードは誰でもアクセス可能です
- 個人情報（メールアドレス、電話番号など）は表示されません
- 予約の組数と参加者数のみを表示します
- より厳密なアクセス制限が必要な場合は、認証機能の追加を検討してください

---

## 🎯 今後の拡張案

- 📧 メールアドレスによる認証機能
- 📈 予約数の推移グラフ
- 📅 カレンダービュー
- 💾 CSVエクスポート機能
- 🔔 満席アラート機能

---

以上でセットアップは完了です！ご不明点があればお気軽にお問い合わせください。
